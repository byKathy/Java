# 15.HTTP之持久连接

在HTTP1.0版本或之前，浏览器每建立一条TCP请求，只能发起一条HTTP请求，完成响应后就将TCP连接关闭。假设一个页面有100个资源，那么浏览器就需要为此建立100次TCP连接，这其实是__高消耗低性能__的做法。原因：
	
* TCP端口消耗过多；
* TCP重复建立握手造成时延和性能消耗；

从HTTP1.0增强版和HTTP1.1开始支持持久连接，所谓__持久连接__就是__使用同一条TCP连接建立多次HTTP请求。__假设每条TCP请求最多可以处理10个HTTP请求，那么原来的100次TCP连接则可减少为10次。那么就可以降低TCP的消耗。

```java
public static void main(String[] args) throws UnknownHostException, IOException {
	Socket socket = new Socket("localhost", 8080);

	BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));

	new Thread(() -> {
		try {
			BufferedReader br = new BufferedReader(new InputStreamReader(socket.getInputStream()));

			String line = null;
			while ((line = br.readLine()) != null) { // 迭代输出的文本
				System.out.println(line);
			}

			br.close();
			bw.close();
			socket.close();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}).start();

	bw.write("GET /springmvc/ HTTP/1.1\r\n");
	bw.write("HOST: localhost:8080\r\n");
	bw.write("Connection: keep-alive\r\n");
	bw.write("\r\n");
	bw.flush();

	bw.write("GET /springmvc/ HTTP/1.1\r\n");
	bw.write("HOST: localhost:8080\r\n");
	bw.write("Connection: close\r\n");
	bw.write("\r\n");
	bw.flush();
}
```

```
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Set-Cookie: JSESSIONID=C1CC998B1DF491A2AA2DFC874624E247; Path=/springmvc/; HttpOnly
Content-Type: text/html;charset=ISO-8859-1
Content-Language: zh-CN
Content-Length: 89
Date: Mon, 28 Apr 2014 10:25:25 GMT


<html>
<head>
<title>Home</title>
</head>
<body>
	<h1>Hello world!</h1>
</body>
</html>
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Set-Cookie: JSESSIONID=3E421B3CB47418054E0DDDA6BCB4CBD0; Path=/springmvc/; HttpOnly
Content-Type: text/html;charset=ISO-8859-1
Content-Language: zh-CN
Content-Length: 89
Date: Mon, 28 Apr 2014 10:25:25 GMT
Connection: close


<html>
<head>
<title>Home</title>
</head>
<body>
	<h1>Hello world!</h1>
</body>
</html>
```
